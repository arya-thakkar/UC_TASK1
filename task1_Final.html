<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <style>
    .container2 {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      padding: 10px;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 8px 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
      box-sizing: border-box;
      transition: transform 0.3s ease-in-out;
    }
    .container2 input:focus{
        outline: 2px solid #45a049;
    }
    .container2 input:hover{
        transform:scale(1.05);
    }
    button{
        width:100px;
        height:40px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        transition: transform 0.3s ease-in-out;
        cursor: pointer;
        gap:15px;
    }
    button:hover{
        background-color: #45a049;
        transform: scale(1.1);
    }
  </style>
  <body>
    <div id="conatainer1">
      <ol id="displayStudents" style="list-style-type: none"></ol>
      <button id="addStudents">Add Student</button>
      <div class="container2">
        <input type="text" id="sName" placeholder="Enter Name" />
        <input type="text" id="college" placeholder="Enter College" />
        <input type="text" id="cgpa" placeholder="Enter CGPA" />
        <input type="text" id="phone" placeholder="Enter Phone Number" />
        <input type="text" id="sapId" placeholder="Enter Sap Id" />
        <input type="text" id="batch" placeholder="Enter Batch" />
        <input type="text" id="year" placeholder="Enter Year" />
        <input type="text" id="address" placeholder="Enter Address" />
      </div>
      <br />
      <button id="submitData" style="display: none">Submit Data</button>
      <button id="updateData" style="display: none; margin-left:15px; ">Update Data</button>
      <button id="deleteData" style="display: none; margin-left:15px;">Delete Data</button>
    </div>
    <div class="updateform" style="display: none; margin-top:20px;">
      <form action="/" id="updateUserData">
        <input type="text" placeholder="Enter Number" id="upNumber" style="margin-top:auto"/>
        <div class="choose" style="margin-top:15px;">
          <label for="update" style="font-size: 15px;">Choose data to update:</label>
          <select name="update" id="upVal" style="width:150px; margin-left:10px; text-align: center;border-radius:5px;">
            <option value="" selected disabled>Select Option</option>
            <option value="name">Name</option>
            <option value="college">College</option>
            <option value="sapId">Sap Id</option>
            <option value="cgpa">CGPA</option>
            <option value="batch">Batch</option>
            <option value="year">Year</option>
            <option value="phone">Phone Number</option>
            <option value="address">Address</option>
          </select>
        </div>
        <input type="text" placeholder="Enter Data" id="update-value" style="margin-top:15px;"/>
        <button id="editData" class="editBtn" style="margin-top:15px;">Edit</button>
      </form>
    </div>
    <input
      type="text"
      placeholder="Enter Number"
      id="delNumber"
      style="display: none; width:300px; margin-top:20px;"
    />
    <button id="removeData" class="editBtn" style="display: none; margin-top:10px;">
      Remove
    </button>
  </body>
  <script>
    const displayStudents = document.getElementById("displayStudents");
    const addStudents = document.getElementById("addStudents");
    const con2 = document.querySelector(".container2");
    const studentName = document.getElementById("sName");
    const colName = document.getElementById("college");
    const cgpa = document.getElementById("cgpa");
    const phoneNumber = document.getElementById("phone");
    const Sapid = document.getElementById("sapId");
    const batch = document.getElementById("batch");
    const year = document.getElementById("year");
    const address = document.getElementById("address");
    const submitData = document.getElementById("submitData");
    const updateData = document.getElementById("updateData");
    const deleteData = document.getElementById("deleteData");
    const input = document.querySelectorAll(".container2 input");
    const listNumber = document.getElementById("upNumber");
    const updatingVal = document.getElementById("upVal");
    const updatedValue = document.getElementById("update-value");
    const editDataBtn = document.getElementById("editData");
    const removeDataBtn = document.getElementById("removeData");
    const delNumber = document.getElementById("delNumber");

    const geturl = "https://studentapi-m7a7.onrender.com/student/all";
    const url = "https://studentapi-m7a7.onrender.com/student/add";

    let defaultStudents = [];
    let newStudent = [];
    con2.style.display = "none";
    function getStudentName() {
      fetch(geturl)
        .then((res) => res.json())
        .then((data) => {
          defaultStudents = data.students.map((s) => ({ ...s, isNew: false }));
          displayStudents.innerHTML = "";

          defaultStudents.forEach((student, index) => {
            const li = document.createElement("li");
            li.innerHTML = `
  <span><strong>${index + 1}.</strong></span>
  <span><strong>Name:</strong> ${student.name}</span>
  <span><strong>College:</strong> ${student.college}</span>
  <span><strong>CGPA:</strong> ${student.cgpa}</span>
  <span><strong>Phone:</strong> ${student.phone}</span>
  <span><strong>SapId:</strong> ${student.sapId}</span>
  <span><strong>Batch:</strong> ${student.batch}</span>
  <span><strong>Year:</strong> ${student.year}</span>
  <span><strong>Address:</strong> ${student.address}</span>
`;
            displayStudents.appendChild(li);
            li.style.fontSize = "18px";
            li.style.display = "flex";
            li.style.gap = "20px";
            li.style.flexWrap = "wrap";
          });

          newStudent.forEach((student, index) => {
            const li = document.createElement("li");
            li.innerHTML = `
  <span><strong>${defaultStudents.length + index + 1}.</strong></span>
  <span><strong>Name:</strong> ${student.name}</span>
  <span><strong>College:</strong> ${student.college}</span>
  <span><strong>CGPA:</strong> ${student.cgpa}</span>
  <span><strong>Phone:</strong> ${student.phone}</span>
  <span><strong>SapId:</strong> ${student.sapId}</span>
  <span><strong>Batch:</strong> ${student.batch}</span>
  <span><strong>Year:</strong> ${student.year}</span>
  <span><strong>Address:</strong> ${student.address}</span>
`;
            displayStudents.appendChild(li);
            li.style.fontSize = "18px";
            li.style.display = "flex";
            li.style.gap = "20px";
            li.style.flexWrap = "wrap";
          });
        })
        .catch((error) => console.error(error));
    }

    getStudentName();

    addStudents.addEventListener("click", () => {
      if (con2.style.display === "none") {
        con2.style.display = "grid";
        submitData.style.display = "inline";
        updateData.style.display = "inline";
        deleteData.style.display = "inline";
      }
    });

    function addStudent() {
      const student = {
        name: studentName.value,
        college: colName.value,
        cgpa: cgpa.value,
        phone: phoneNumber.value,
        sapId: Sapid.value,
        batch: batch.value,
        year: year.value,
        address: address.value,
        isNew: true,
      };

      let check = false;
      input.forEach((inputField) => {
        if (inputField.value === "") check = true;
      });

      if (check) {
        alert("Please fill all the fields");
        return;
      }

      for (let i = 0; i < newStudent.length; i++) {
        if (newStudent[i].sapId === student.sapId) {
          alert("Student with this SapId already exists");
          return;
        }
      }

      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(student),
      })
        .then((response) => response.json())
        .then((data) => {
          newStudent.push(student);
          getStudentName();
          input.forEach((inputField) => (inputField.value = ""));
          alert("Data added successfully");
        })
        .catch(() => alert("Error adding student"));
    }

    submitData.addEventListener("click", () => {
      delNumber.style.display = "none";
      removeDataBtn.style.display = "none";
      document.querySelector(".updateform").style.display = "none";
      addStudent();
    });

    updateData.addEventListener("click", () => {
      delNumber.style.display = "none";
      removeDataBtn.style.display = "none";
      document.querySelector(".updateform").style.display = "block";
    });

    editDataBtn.addEventListener("click", (e) => {
      e.preventDefault();

      const givenNumber = parseInt(listNumber.value);
      const index = givenNumber - 1;

      const allStudents = [...defaultStudents, ...newStudent];

      if (
        isNaN(givenNumber) ||
        givenNumber < 1 ||
        givenNumber > allStudents.length
      ) {
        alert("Invalid list number!");
        return;
      }

      const student = allStudents[index];

      if (!student.isNew) {
        alert("Default students cannot be updated!");
        return;
      }

      const field = updatingVal.value;
      const newValue = updatedValue.value;

      student[field] = newValue;

      if (student._id) {
        fetch(
          `https://studentapi-m7a7.onrender.com/student/update/${student._id}`,
          {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ [field]: newValue }),
          }
        )
          .then((res) => res.json())
          .then(() => {
            alert(
              `Student at list number ${givenNumber} updated successfully!`
            );
            getStudentName();
            listNumber.value = "";
            updatedValue.value = "";
          })
          .catch((err) => console.error(err));
      } else {
        alert(`Student at list number ${givenNumber} updated locally!`);
        getStudentName();
        upNumber.value = "";
        updatedValue.value = "";
      }
    });
    deleteData.addEventListener("click", () => {
      document.querySelector(".updateform").style.display = "none";
      delNumber.style.display = "block";
      removeDataBtn.style.display = "inline-block";
    });

    removeDataBtn.addEventListener("click", (e) => {
      e.preventDefault();

      const givenNumber = parseInt(delNumber.value);
      const allStudents = [...defaultStudents, ...newStudent];

      if (
        isNaN(givenNumber) ||
        givenNumber < 1 ||
        givenNumber > allStudents.length
      ) {
        alert("Invalid list number!");
        return;
      }

      const student = allStudents[givenNumber - 1];

      if (!student.isNew) {
        alert("Default students cannot be deleted!");
        delNumber.style.display = "none";
        removeDataBtn.style.display = "none";
        delNumber.value = "";
        return;
      }

      if (student._id) {
        fetch(
          `https://studentapi-m7a7.onrender.com/student/delete/${student._id}`,
          {
            method: "DELETE",
          }
        )
          .then((res) => res.json())
          .then(() => {
            newStudent = newStudent.filter((s) => s._id !== student._id);
            alert(
              `Student at list number ${givenNumber} deleted successfully!`
            );
            getStudentName();
            delNumber.value = "";
            delNumber.style.display = "none";
            removeDataBtn.style.display = "none";
          })
          .catch((err) => console.error(err));
      } else {
        newStudent = newStudent.filter((s) => s !== student);
        alert(`Student at list number ${givenNumber} deleted locally!`);
        getStudentName();
        delNumber.value = "";
        removeDataBtn.style.display = "none";
      }
    });
  </script>
</html>
